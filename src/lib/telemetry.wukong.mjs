import{createHash as p}from"node:crypto";import o from"node:os";function c(){let e=process.env.WUKONG_LANG||process.env.LANG||process.env.LC_ALL||process.env.LANGUAGE||"";return/^zh/i.test(e)?"zh":"en"}function i(){let e=process.argv.find(n=>n.startsWith("--lang="));if(e){let n=e.split("=")[1]?.toLowerCase();if(["zh","en"].includes(n))return n}return null}function t(){return i()||c()}var g="https://api.hisread.com/api/track/wukong";function m(){let e=`${o.hostname()}|${o.arch()}`;return p("sha256").update(e).digest("hex").slice(0,12)}async function u(e,n={version:"unknown"},r={}){if(process.env.WUKONG_NO_TELEMETRY==="1")return;let s=t(r.argv||process.argv),a={event:e,time:new Date().getTime(),platform:process.platform,arch:process.arch,node:process.version,lang:s,cli:r.cliName||"unknown-cli",id:m(),...n};try{await fetch(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}catch{}}export{t as getLang,u as sendTelemetry};
