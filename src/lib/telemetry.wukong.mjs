import{createHash as g}from"node:crypto";import r from"node:os";function p(){let e=process.env.WUKONG_LANG||process.env.LANG||process.env.LC_ALL||process.env.LANGUAGE||"";return/^zh/i.test(e)?"zh":"en"}function l(){let e=process.argv.find(n=>n.startsWith("--lang="));if(e){let n=e.split("=")[1]?.toLowerCase();if(["zh","en"].includes(n))return n}return null}function t(){return l()||p()}var m="https://api.hisread.com/api/track/wukong";function u(){let e=`${r.hostname()}|${r.arch()}`;return g("sha256").update(e).digest("hex").slice(0,12)}async function f(e,n={version:"unknown"},s={}){if(process.env.WUKONG_NO_TELEMETRY==="1")return;let a=t(),c={event:e,time:new Date().getTime(),platform:process.platform,arch:process.arch,node:process.version,lang:a,cli:s.cliName||"unknown-cli",id:u(),...n},o=new AbortController,i=setTimeout(()=>o.abort(),500);try{await fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c),signal:o.signal})}catch{}finally{clearTimeout(i)}}export{t as getLang,f as sendTelemetry};
