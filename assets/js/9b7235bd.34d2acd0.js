"use strict";(self.webpackChunkwukong_deploy_website=self.webpackChunkwukong_deploy_website||[]).push([[5223],{5866:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>o,contentTitle:()=>a,default:()=>t,frontMatter:()=>i,metadata:()=>d,toc:()=>l});const d=JSON.parse('{"id":"examples/use-cases","title":"\u4f7f\u7528\u793a\u4f8b","description":"\u672c\u6587\u6863\u901a\u8fc7\u5177\u4f53\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u4f7f\u7528 wukong-deploy \u6765\u5904\u7406\u4e0d\u540c\u7684\u90e8\u7f72\u573a\u666f\u3002","source":"@site/docs/examples/use-cases.md","sourceDirName":"examples","slug":"/examples/use-cases","permalink":"/wukong-deploy/docs/examples/use-cases","draft":false,"unlisted":false,"editUrl":"https://github.com/tomatobybike/wukong-deploy/tree/main/wukong-deploy-website/docs/examples/use-cases.md","tags":[],"version":"current","lastUpdatedBy":"tom","lastUpdatedAt":1759746647000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"\u9879\u76ee\u7ed3\u6784","permalink":"/wukong-deploy/docs/best-practices/project-structure"}}');var r=s(4848),c=s(8453);const i={sidebar_position:1},a="\u4f7f\u7528\u793a\u4f8b",o={},l=[{value:"\u57fa\u7840\u793a\u4f8b\uff1a\u90e8\u7f72\u524d\u7aef\u5e94\u7528",id:"\u57fa\u7840\u793a\u4f8b\u90e8\u7f72\u524d\u7aef\u5e94\u7528",level:2},{value:"\u9ad8\u7ea7\u793a\u4f8b\uff1a\u591a\u73af\u5883\u90e8\u7f72",id:"\u9ad8\u7ea7\u793a\u4f8b\u591a\u73af\u5883\u90e8\u7f72",level:2},{value:"Node.js \u5e94\u7528\u90e8\u7f72\u793a\u4f8b",id:"nodejs-\u5e94\u7528\u90e8\u7f72\u793a\u4f8b",level:2},{value:"\u4f7f\u7528\u672c\u5730\u547d\u4ee4\u793a\u4f8b",id:"\u4f7f\u7528\u672c\u5730\u547d\u4ee4\u793a\u4f8b",level:2},{value:"\u81ea\u5b9a\u4e49\u9519\u8bef\u5904\u7406\u793a\u4f8b",id:"\u81ea\u5b9a\u4e49\u9519\u8bef\u5904\u7406\u793a\u4f8b",level:2},{value:"\u6267\u884c\u6548\u679c\u9884\u89c8",id:"\u6267\u884c\u6548\u679c\u9884\u89c8",level:2},{value:"\u5728\u7ebf\u6f14\u793a",id:"\u5728\u7ebf\u6f14\u793a",level:2},{value:"\u5e38\u89c1\u95ee\u9898\u6392\u67e5\u793a\u4f8b",id:"\u5e38\u89c1\u95ee\u9898\u6392\u67e5\u793a\u4f8b",level:2}];function p(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,c.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"\u4f7f\u7528\u793a\u4f8b",children:"\u4f7f\u7528\u793a\u4f8b"})}),"\n",(0,r.jsx)(e.p,{children:"\u672c\u6587\u6863\u901a\u8fc7\u5177\u4f53\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u4f7f\u7528 wukong-deploy \u6765\u5904\u7406\u4e0d\u540c\u7684\u90e8\u7f72\u573a\u666f\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u57fa\u7840\u793a\u4f8b\u90e8\u7f72\u524d\u7aef\u5e94\u7528",children:"\u57fa\u7840\u793a\u4f8b\uff1a\u90e8\u7f72\u524d\u7aef\u5e94\u7528"}),"\n",(0,r.jsx)(e.p,{children:"\u8fd9\u4e2a\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u90e8\u7f72\u4e00\u4e2a\u5178\u578b\u7684\u524d\u7aef\u5e94\u7528\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:'// config/config.mjs\nexport default {\n  servers: {\n    prod: {\n      name: "\u751f\u4ea7\u670d\u52a1\u5668",\n      host: "example.com",\n      username: "deploy",\n      passwordEnv: "SERVER_PROD_PASSWORD",\n      commands: [\n        {\n          cmd: "cd /var/www/app && git pull",\n          description: "\u62c9\u53d6\u6700\u65b0\u4ee3\u7801"\n        },\n        {\n          cmd: "npm ci",\n          cwd: "/var/www/app",\n          description: "\u5b89\u88c5\u4f9d\u8d56"\n        },\n        {\n          cmd: "npm run build",\n          cwd: "/var/www/app",\n          description: "\u6784\u5efa\u5e94\u7528"\n        },\n        {\n          cmd: "cp -r dist/* /var/www/html/",\n          description: "\u90e8\u7f72\u6784\u5efa\u6587\u4ef6"\n        }\n      ]\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u9ad8\u7ea7\u793a\u4f8b\u591a\u73af\u5883\u90e8\u7f72",children:"\u9ad8\u7ea7\u793a\u4f8b\uff1a\u591a\u73af\u5883\u90e8\u7f72"}),"\n",(0,r.jsx)(e.p,{children:"\u8fd9\u4e2a\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u914d\u7f6e\u591a\u73af\u5883\u90e8\u7f72\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:'// config/config.mjs\nexport default {\n  servers: {\n    dev: {\n      name: "\u5f00\u53d1\u73af\u5883",\n      host: "dev.example.com",\n      username: "deploy",\n      passwordEnv: "SERVER_DEV_PASSWORD",\n      commands: [\n        {\n          cmd: "git checkout develop",\n          cwd: "/var/www/app",\n          description: "\u5207\u6362\u5230\u5f00\u53d1\u5206\u652f"\n        },\n        {\n          cmd: "git pull",\n          cwd: "/var/www/app",\n          description: "\u66f4\u65b0\u4ee3\u7801"\n        },\n        {\n          cmd: "npm install",\n          cwd: "/var/www/app",\n          description: "\u5b89\u88c5\u4f9d\u8d56"\n        }\n      ]\n    },\n    staging: {\n      name: "\u9884\u53d1\u73af\u5883",\n      host: "staging.example.com",\n      username: "deploy",\n      passwordEnv: "SERVER_STAGING_PASSWORD",\n      commands: [\n        {\n          cmd: "git checkout staging",\n          cwd: "/var/www/app",\n          description: "\u5207\u6362\u5230\u9884\u53d1\u5206\u652f"\n        },\n        {\n          cmd: "git pull",\n          cwd: "/var/www/app",\n          description: "\u66f4\u65b0\u4ee3\u7801"\n        }\n      ]\n    },\n    prod: {\n      name: "\u751f\u4ea7\u73af\u5883",\n      host: "example.com",\n      username: "deploy",\n      passwordEnv: "SERVER_PROD_PASSWORD",\n      commands: [\n        {\n          cmd: "git checkout main",\n          cwd: "/var/www/app",\n          description: "\u5207\u6362\u5230\u4e3b\u5206\u652f"\n        },\n        {\n          cmd: "git pull",\n          cwd: "/var/www/app",\n          description: "\u66f4\u65b0\u4ee3\u7801"\n        }\n      ]\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"nodejs-\u5e94\u7528\u90e8\u7f72\u793a\u4f8b",children:"Node.js \u5e94\u7528\u90e8\u7f72\u793a\u4f8b"}),"\n",(0,r.jsx)(e.p,{children:"\u8fd9\u4e2a\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u90e8\u7f72 Node.js \u5e94\u7528\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:'// config/config.mjs\nexport default {\n  servers: {\n    prod: {\n      name: "\u751f\u4ea7\u670d\u52a1\u5668",\n      host: "example.com",\n      username: "deploy",\n      passwordEnv: "SERVER_PROD_PASSWORD",\n      commands: [\n        // \u66f4\u65b0\u4ee3\u7801\n        {\n          cmd: "git pull origin main",\n          cwd: "/var/www/app",\n          description: "\u66f4\u65b0\u4ee3\u7801"\n        },\n        // \u5b89\u88c5\u4f9d\u8d56\n        {\n          cmd: "npm ci --production",\n          cwd: "/var/www/app",\n          description: "\u5b89\u88c5\u751f\u4ea7\u4f9d\u8d56"\n        },\n        // \u6784\u5efa\n        {\n          cmd: "npm run build",\n          cwd: "/var/www/app",\n          description: "\u6784\u5efa\u5e94\u7528"\n        },\n        // \u6570\u636e\u5e93\u8fc1\u79fb\n        {\n          cmd: "npm run migrate",\n          cwd: "/var/www/app",\n          description: "\u6267\u884c\u6570\u636e\u5e93\u8fc1\u79fb"\n        },\n        // \u91cd\u542f\u670d\u52a1\n        {\n          cmd: "pm2 reload app",\n          cwd: "/var/www/app",\n          description: "\u91cd\u542f\u5e94\u7528"\n        }\n      ],\n      // \u6dfb\u52a0\u9519\u8bef\u5904\u7406\n      errorMatch: [\n        /Error:/,\n        /failed/i,\n        /error/i\n      ]\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u4f7f\u7528\u672c\u5730\u547d\u4ee4\u793a\u4f8b",children:"\u4f7f\u7528\u672c\u5730\u547d\u4ee4\u793a\u4f8b"}),"\n",(0,r.jsx)(e.p,{children:"\u8fd9\u4e2a\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u7ed3\u5408\u4f7f\u7528\u8fdc\u7a0b\u547d\u4ee4\u548c\u672c\u5730\u547d\u4ee4\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:'// config/config.mjs\nexport default {\n  servers: {\n    prod: {\n      name: "\u751f\u4ea7\u670d\u52a1\u5668",\n      host: "example.com",\n      username: "deploy",\n      passwordEnv: "SERVER_PROD_PASSWORD",\n      commands: [\n        // \u672c\u5730\u6784\u5efa\n        {\n          cmd: "npm run build",\n          description: "\u672c\u5730\u6784\u5efa",\n          isLocal: true\n        },\n        // \u672c\u5730\u6253\u5305\n        {\n          cmd: "tar -czf dist.tar.gz dist/",\n          description: "\u6253\u5305\u6784\u5efa\u6587\u4ef6",\n          isLocal: true\n        },\n        // \u8fdc\u7a0b\u90e8\u7f72\n        {\n          cmd: "rm -rf /var/www/backup && mv /var/www/html /var/www/backup",\n          description: "\u5907\u4efd\u5f53\u524d\u7248\u672c"\n        },\n        {\n          cmd: "tar -xzf dist.tar.gz -C /var/www/html",\n          description: "\u89e3\u538b\u65b0\u7248\u672c"\n        },\n        // \u672c\u5730\u6e05\u7406\n        {\n          cmd: "rm dist.tar.gz",\n          description: "\u6e05\u7406\u672c\u5730\u6587\u4ef6",\n          isLocal: true\n        }\n      ]\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u81ea\u5b9a\u4e49\u9519\u8bef\u5904\u7406\u793a\u4f8b",children:"\u81ea\u5b9a\u4e49\u9519\u8bef\u5904\u7406\u793a\u4f8b"}),"\n",(0,r.jsx)(e.p,{children:"\u8fd9\u4e2a\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u914d\u7f6e\u81ea\u5b9a\u4e49\u9519\u8bef\u5904\u7406\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:'// config/config.mjs\nexport default {\n  servers: {\n    prod: {\n      name: "\u751f\u4ea7\u670d\u52a1\u5668",\n      host: "example.com",\n      username: "deploy",\n      passwordEnv: "SERVER_PROD_PASSWORD",\n      commands: [\n        {\n          cmd: "npm ci",\n          cwd: "/var/www/app",\n          description: "\u5b89\u88c5\u4f9d\u8d56",\n          exitOnStdErr: false,  // \u5141\u8bb8 stderr \u8f93\u51fa\n          errorMatch: [\n            /error/i,  // \u5339\u914d\u9519\u8bef\u4fe1\u606f\n            /failed/i, // \u5339\u914d\u5931\u8d25\u4fe1\u606f\n            /ENOENT/   // \u5339\u914d\u6587\u4ef6\u4e0d\u5b58\u5728\u9519\u8bef\n          ]\n        },\n        {\n          cmd: "npm run build",\n          cwd: "/var/www/app",\n          description: "\u6784\u5efa\u5e94\u7528",\n          exitOnStdErr: true,   // \u9047\u5230\u9519\u8bef\u7acb\u5373\u9000\u51fa\n          errorMatch: /Failed to compile/  // \u5339\u914d\u7f16\u8bd1\u9519\u8bef\n        }\n      ]\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u6267\u884c\u6548\u679c\u9884\u89c8",children:"\u6267\u884c\u6548\u679c\u9884\u89c8"}),"\n",(0,r.jsx)(e.p,{children:"\u4ee5\u4e0b\u662f\u4f7f\u7528 wukong-deploy \u6267\u884c\u90e8\u7f72\u65f6\u7684\u7ec8\u7aef\u754c\u9762\u9884\u89c8\uff1a"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{alt:"\u90e8\u7f72\u9884\u89c8",src:s(7360).A+"",width:"1256",height:"727"})}),"\n",(0,r.jsx)(e.h2,{id:"\u5728\u7ebf\u6f14\u793a",children:"\u5728\u7ebf\u6f14\u793a"}),"\n",(0,r.jsx)(e.p,{children:"\u60a8\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6b65\u9aa4\u4f53\u9a8c wukong-deploy\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u5728\u7ebf\u5c1d\u8bd5\uff08\u65e0\u9700\u5b89\u88c5\uff09\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npx wukong-deploy@latest init\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u67e5\u770b\u6f14\u793a\u89c6\u9891\uff1a"}),"\n",(0,r.jsxs)(e.p,{children:["\u8bbf\u95ee\u6211\u4eec\u7684 ",(0,r.jsx)(e.a,{href:"https://space.bilibili.com/",children:"B\u7ad9\u8d26\u53f7"})," \u89c2\u770b\u5b8c\u6574\u6559\u7a0b"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u5e38\u89c1\u95ee\u9898\u6392\u67e5\u793a\u4f8b",children:"\u5e38\u89c1\u95ee\u9898\u6392\u67e5\u793a\u4f8b"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u8fde\u63a5\u5931\u8d25"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u68c0\u67e5\u670d\u52a1\u5668\u8fde\u901a\u6027\nwukong-deploy doctor\n\n# \u8f93\u51fa\u8be6\u7ec6\u65e5\u5fd7\nWUKONG_DEBUG=1 wukong-deploy deploy\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u6743\u9650\u95ee\u9898"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# \u786e\u8ba4\u76ee\u6807\u76ee\u5f55\u6743\u9650\nls -la /var/www/app\n\n# \u4f7f\u7528 sudo \u6267\u884c\u547d\u4ee4\n{\n  cmd: "sudo npm run build",\n  description: "\u6784\u5efa\u5e94\u7528"\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"Node.js \u7248\u672c\u95ee\u9898"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# \u5728\u547d\u4ee4\u4e2d\u6307\u5b9a Node.js \u7248\u672c\n{\n  cmd: "source ~/.nvm/nvm.sh && nvm use 16 && npm run build",\n  description: "\u4f7f\u7528 Node.js 16 \u6784\u5efa"\n}\n'})}),"\n"]}),"\n"]})]})}function t(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(p,{...n})}):p(n)}},7360:(n,e,s)=>{s.d(e,{A:()=>d});const d=s.p+"assets/images/demo-acc6f3d17ca7ee5eb2ec7214d02074ac.svg"},8453:(n,e,s)=>{s.d(e,{R:()=>i,x:()=>a});var d=s(6540);const r={},c=d.createContext(r);function i(n){const e=d.useContext(c);return d.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:i(n.components),d.createElement(c.Provider,{value:e},n.children)}}}]);